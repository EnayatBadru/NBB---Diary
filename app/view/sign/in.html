<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- metaTags -->
  <meta name="description" content="sign in - faca o login no sistem NDD-Diary,
    é um sistema de diario virtual para pessoas que precisam de ajuda de um profissional de saude mental">
  <meta name="keywords" content="psychologist, psicologia, saúde mental, cerebro, NDD, Diary, NDD-Diary">

  <!-- author -->
  <meta name="author" content="NBB">

  <!-- favicons -->
  <link rel="shortcut icon" href="../../assets/img/logo.png" type="image/x-icon">

  <!-- css -->
  <link rel="stylesheet" href="../../assets/css/default.css">
  <link rel="stylesheet" href="../../assets/css/sign.css">

  <!-- Firebase SDK: App e Auth (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>

  <!-- frameworks -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" defer></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js" defer></script>

  <!-- title -->
  <title>sign in</title>
</head>

<body>
  <form action="#" method="post" autocomplete="off">
    <span class="title">login</span>

    <div class="user">
      <!-- Utilize o campo "user" para armazenar o email -->
      <input type="text" name="user" id="user" minlength="3" maxlength="50" required="required" autocomplete="off">
      <label for="user">
        <span><ion-icon name="person-sharp"></ion-icon></span>
        <span>email do usuario</span>
      </label>
    </div>
    <div class="password">
      <input type="password" name="password" id="password" minlength="8" maxlength="20" required="required" autocomplete="off">
      <label for="password">
        <span><ion-icon name="key-sharp"></ion-icon></span>
        <span>senha</span>
      </label>
    </div>
    <div class="footerForm">
      <button type="submit">entrar</button>
      <button type="button" id="google-login">entrar com google</button>
      <div class="account">
        <span>Cria uma conta,</span>
        <span><a href="up.html">cadastrar!</a></span>
      </div>
      <span class="forgot">
        <a href="forgotPassword.html">Esqueceu a senha?</a>
      </span>
    </div>
  </form>

  <script>
    // Configuração do Firebase: substitua pelos dados do seu projeto
    const firebaseConfig = {
      apiKey: "AIzaSyAbKVhAbVOuzlPXpfYlCl8lRyXbxOeJqZE",
      authDomain: "ndd-diary-2f5d6.firebaseapp.com",
      projectId: "ndd-diary-2f5d6",
      storageBucket: "ndd-diary-2f5d6.firebasestorage.app",
      messagingSenderId: "582152839503",
      appId: "1:582152839503:web:67f06b4aaee3041cdd253a",
      measurementId: "G-H783JCC73Q"
    };

    console.log("Inicializando Firebase...");
    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    console.log("Firebase inicializado com sucesso.");

    // Referências aos elementos do formulário
    const loginForm = document.querySelector('form');
    const emailInput = document.getElementById('user');
    const passwordInput = document.getElementById('password');
    const googleLoginButton = document.getElementById('google-login');

    // Evento para login com email e senha
    loginForm.addEventListener('submit', function (event) {
      event.preventDefault(); // previne o envio padrão do formulário
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      console.log("Tentando login com email/senha...");
      console.log("Email:", email);
      console.log("Senha: ******");

      // Verifica se os campos não estão vazios
      if (!email || !password) {
        console.error("Email ou senha não foram preenchidos.");
        alert("Por favor, preencha todos os campos.");
        return;
      }

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("Autenticação com email/senha bem-sucedida.");
          const user = userCredential.user;
          console.log("Usuário autenticado:", user);
          alert("Login efetuado com sucesso! Bem-vindo, " + user.email);
          // Aqui você pode redirecionar o usuário ou atualizar a interface
        })
        .catch((error) => {
          console.error("Erro durante o login com email/senha:", error);
          alert("Erro ao fazer login: " + error.message);
        });
    });

    // Evento para login com Google
    googleLoginButton.addEventListener('click', function () {
      console.log("Tentando login com Google...");
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then((result) => {
          console.log("Autenticação com Google bem-sucedida.");
          const user = result.user;
          console.log("Usuário autenticado com Google:", user);
          alert("Login com Google efetuado com sucesso! Bem-vindo, " + user.email);
          // Aqui você pode redirecionar o usuário ou atualizar a interface
        })
        .catch((error) => {
          console.error("Erro durante o login com Google:", error);
          alert("Erro ao fazer login com Google: " + error.message);
        });
    });
  </script>
</body>

</html>
