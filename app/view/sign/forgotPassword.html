<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Meta Tags -->
    <meta name="description" content="Recuperação de senha - Recupere sua senha no sistema NDD-Diary, um diário virtual para suporte de saúde mental">
    <meta name="keywords" content="psychologist, psicologia, saúde mental, cerebro, NDD, Diary, NDD-Diary, recuperação de senha">
    <meta name="author" content="NBB">

    <!-- 
    Criado por: 
        * -- Umme Aymanah Abacar Nzé -- * (N)
        * -- Edivânia Jarmindo Bila -- * (B)
        * -- Enayatolah Agibo Badrú -- * (B)
        (NBB) - Diary
        em 27.02.2025
    -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="../../assets/img/logo.png" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="../../assets/css/default.css">
    <link rel="stylesheet" href="../../assets/css/sign.css">

    <!-- Firebase Scripts (Versão 8.x) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" defer></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js" defer></script>

    <!-- Título -->
    <title>Forgot Password - NDD Diary</title>
</head>

<body>
    <form action="#" method="post" id="recover-form" autocomplete="on">
        <span class="title">recuperação de senha</span>

        <div class="user">
            <input type="email" name="email" id="email" minlength="3" maxlength="50" required="required" autocomplete="email">
            <label for="email">
                <span><ion-icon name="mail-outline"></ion-icon></span>
                <span>digite seu email</span>
            </label>
        </div>
        <div class="footerForm">
            <button type="submit">recuperar</button>
            <span class="forgot"><a href="in.html">voltar ao login</a></span>
        </div>
    </form>

    <!-- Configuração e Lógica do Firebase -->
    <script>
        // Configurações do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAbKVhAbVOuzlPXpfYlCl8lRyXbxOeJqZE",
            authDomain: "ndd-diary-2f5d6.firebaseapp.com",
            projectId: "ndd-diary-2f5d6",
            storageBucket: "ndd-diary-2f5d6.firebasestorage.app",
            messagingSenderId: "582152839503",
            appId: "1:582152839503:web:67f06b4aaee3041cdd253a",
            measurementId: "G-H783JCC73Q"
        };

        // Inicialização do Firebase com tratamento de erro
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase inicializado com sucesso!");
        } catch (error) {
            console.error("Erro ao inicializar o Firebase:", error);
            alert("Ocorreu um erro ao carregar a aplicação. Por favor, tente novamente mais tarde.");
        }

        // Garantir que o DOM esteja pronto antes de manipular elementos
        document.addEventListener('DOMContentLoaded', function() {
            const auth = firebase.auth();
            const recoverForm = document.getElementById('recover-form');

            if (recoverForm) {
                recoverForm.addEventListener('submit', function(event) {
                    event.preventDefault(); // Impede o envio padrão do formulário
                    const email = document.getElementById('email').value;

                    // Enviar email de recuperação de senha
                    auth.sendPasswordResetEmail(email)
                        .then(() => {
                            console.log("Email de recuperação enviado com sucesso para:", email);
                            alert("Um email de recuperação foi enviado para " + email + ". Verifique sua caixa de entrada ou spam.");
                            // Opcional: redirecionar para a página de login após o envio
                            window.location.href = 'in.html';
                        })
                        .catch((error) => {
                            console.error("Erro ao enviar email de recuperação:", error);
                            let errorMessage = "Erro ao enviar o email de recuperação. Tente novamente.";
                            switch (error.code) {
                                case 'auth/invalid-email':
                                    errorMessage = "Email inválido. Por favor, insira um email válido.";
                                    break;
                                case 'auth/user-not-found':
                                    errorMessage = "Nenhum usuário encontrado com este email.";
                                    break;
                                default:
                                    errorMessage += " (" + error.message + ")";
                            }
                            alert(errorMessage);
                        });
                });
            } else {
                console.error("Formulário 'recover-form' não encontrado no DOM.");
            }
        });
    </script>
</body>

</html>